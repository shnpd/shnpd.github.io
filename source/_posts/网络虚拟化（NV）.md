---
title: 网络虚拟化（NV）
toc: true
date: 2022-06-13 11:24:40
tags: 网络 运维 安全架构
categories: 杂项
---

​​点击阅读更多查看文章内容<!--more-->

# 网络虚拟化（NV）
参考视频：[云计算通识知识-网络虚拟化-5](https://www.bilibili.com/video/BV1jR4y1V7Nm)
# 定义
将物理网络虚拟出多个相互隔离的虚拟网络，从而使得不同用户之间使用独立的网络资源，从而提高网络资源利用率，实现弹性的网络

VLAN就是一种网络虚拟化，在原有网络基础上通过VLAN Tag划分出多个广播域

网络虚拟化保障我们创建出来的虚拟机可以正常通信，访问网络

# 目的
节省物理主机的网卡设备资源，并且可以提供应用的虚拟网络所需的L2-K7层的网络服务

网络虚拟化软件提供逻辑上的交换机和路由器（L2-L3）逻辑负载均衡器，逻辑防火墙（L4-L7）等，且可以以任何形式进行组装，从而为虚拟机提供一个完整的L2-L7层的虚拟网络拓扑

# 特点
- **与物理层解耦**
 接管所有的网络服务、特性和应用的虚拟网络必要的配置，简化这些服务、配置将它们映射给虚拟化层，使用服务的应用只需要和虚拟化网络层打交道
-  **网络服务抽象化**
 虚拟网络层可以提供逻辑接口、逻辑交换机和路由器等，并确保这些网络设备和服务的监控、服务质量（QoS）和安全。可以和任意安全策略自由组合成任意拓扑的虚拟网络
- **网络按需自动化**
通过**API**自动化部署，一个完整的、功能丰富的虚拟网络可以自由部署在底层物理设施上。通过网络虚拟化，每个应用的虚拟网络和安全拓扑拥有移动性
- **多租户网络安全隔离**
计算虚拟化使多种业务或不同租户资源共享同一个数据中心资源，虚拟网络则可以同时为多租户提供安全隔离网络，租户之间的网络在逻辑上互相隔离，互不影响。

# 虚拟化中的网络架构
## 网卡虚拟化
**软件网卡虚拟化**
主要通过软件控制各个虚拟机共享同一块物理网卡实现。软件虚拟出来的网卡可以有单独的MAC地址、IP地址

所有虚拟机的网卡通过虚拟交换机以及物理网卡连接至物理交换机。虚拟交换机负责将虚拟机上的数据报文从物理网口转发出去

![在这里插入图片描述](https://cdn.jsdelivr.net/gh/shnpd/blog-pic@main/csdn/8af9095260ba222f66bf5c1b0119e129_1740930518284.png)
**硬件网卡虚拟化（应用较多）**
主要用到的技术是单根I/O虚拟化（SingleRootI/O Virtualization，SR-IOV），就是I/O直通技术，通过硬件的辅助可以让虚拟机直接访问物理设备，而不需要通过VMM。该技术可以直接虚拟出128-512张网卡，可以让虚拟机都拿到一块独立的网卡，直接使用IO资源。SR-IOV能够让网络传输绕过软件模拟层，直接分配到虚拟机，这样就降低了软件模拟层中的I/O开销。

## 交换机虚拟化
OVS（OpenvSwitch）开放虚拟化软件交换机，是一款基于软件实现的开源虚拟以太网交换机，使用开源Apache20许可协议，主要用于虚拟机VM环境、

与众多开源的虚拟化平台相整合（支持Xen、KVM及VirtualBox多种虚拟化技术），主要有两个作用：
- 传递虚拟机之间的流量
- 实现虚拟机和外界网络的通信
![在这里插入图片描述](https://cdn.jsdelivr.net/gh/shnpd/blog-pic@main/csdn/8c01e43d0b2c12e57e3833a3eb052e1a_1740930518284.png)

## 网络架构
虚拟化中的网络架构通常使用虚拟交换机来连接虚拟机与物理交换机，实现虚拟机之间的通信
![在这里插入图片描述](https://cdn.jsdelivr.net/gh/shnpd/blog-pic@main/csdn/bdc06fd5a3cdccb5023fc34e1ce3eb49_1740930525687.png)
# 虚拟化中的关键网络资源
虚拟化中的关键网络资源大致可以分为：
- 物理资源：物理服务器（提供物理网卡）、物理交换机（提供物理网络）
- 虚拟资源：虚拟机（提供虚拟网卡）、虚拟交换机（提供虚拟交换端口（组）和上行链路）

虚拟交换机在虚拟化网络中起到承上启下的作用


# 虚拟化中的数据转发路径
- 相同端口组不同服务器内的虚拟机通讯需要经过物理网络
- 相同端口组相同服务器内的虚拟机通讯不需要经过物理网络
- 不同端口组相同服务器的虚拟机通讯需要经过物理网络

![在这里插入图片描述](https://cdn.jsdelivr.net/gh/shnpd/blog-pic@main/csdn/7a5ae54a86853b4bd2bbdc118a51111c_1740930525687.png)
# 虚拟化网络
## 链路虚拟化：虚链路聚合
VPC（Virtual Port Channel）虚链路聚合，是最常见的二层虚拟化技术

链路聚合将多个物理端口捆绑在一起，虚拟成为一个逻辑端口。但传统链路聚合不能跨设备，VPC很好解决了这个问题，既可以跨设备，又可以增加链路带宽、实现链路层的高可用性
![在这里插入图片描述](https://cdn.jsdelivr.net/gh/shnpd/blog-pic@main/csdn/761f4e401d95fb5c3ab75e3ba445b075_1740930525687.png)
## 链路虚拟化：隧道协议
隧道协议（Tunneling Protocol）：指通过隧道协议使多个不同协议的网络实现互联。使用隧道传递的数据可以是不同协议的数据帧或包。隧道可以将数据流强制送到特定的地址，并隐藏中间结点的网络地址，还可根据需要，提供对数据加密的功能。

典型的隧道协议：
GRE（Generic Routing Encapsulation）通用路由封装
IPsec（Internet Protocol Security）Internet协议安全

![在这里插入图片描述](https://cdn.jsdelivr.net/gh/shnpd/blog-pic@main/csdn/4e9e5a4454b591e389200c9f4895ec08_1740930525687.png)
## 虚拟网络
虚拟网络（Virtual Network）：是由虚拟链路组成的网络

虚拟网络节点之间的连接并不使用物理线缆连接，而是依靠特定的虚拟化链路相连

典型的虚拟网络包括：
层叠网络（虚拟二层延伸网络）
VPN网络

**VXLAN**
VXLAN（VirtualXtensible Local Area Network）虚拟扩展局域网：很好地解决了现有VLAN技术无法满足大二层网络需求的问题
VXLAN技术是一种大二层的虚拟网络技术
原理是引入一个UDP格式的外层隧道作为数据链路层，而原有数据报文内容作为隧道净荷加以传输
![在这里插入图片描述](https://cdn.jsdelivr.net/gh/shnpd/blog-pic@main/csdn/b326c35abfbca0a3a0425c8f621323aa_1740930525687.png)

**虚拟专用网**

VPN（Virtual Private Network）虚拟专用网：是一种常用于连接中、大型企业或团体与团体间的私人网络的通信方法。

通过公用的网络架构（比如互联网）来传送内联网的信息。

利用已加密的隧道协议来达到保密、终端认证、信息准确性等安全效果。这种技术可以在不安全的网络上传送可靠的、安全的信息。

![在这里插入图片描述](https://cdn.jsdelivr.net/gh/shnpd/blog-pic@main/csdn/db9530d5a8ba767d222e94c893d67ecf_1740930533785.png)

